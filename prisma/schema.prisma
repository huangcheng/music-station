// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Genre {
  id   Int    @id @default(autoincrement())
  name String @unique

  music MusicGenre[]
}

model Album {
  id       Int     @id @default(autoincrement())
  name     String  @unique
  year     Int?
  date     String?
  tracks   Int?
  artistId Int?

  music  Music[]
  artist Artist? @relation(fields: [artistId], references: [id])
}

model Artist {
  id   Int    @id @default(autoincrement())
  name String @unique

  music  Music[]
  albums Album[]
}

model Music {
  id               Int          @id @default(autoincrement())
  hash             String       @unique
  name             String
  year             Int?
  artistId         Int?
  albumId          Int?
  track            Int?
  disk             Int?
  cover            String?
  file             String
  date             String?
  codec            String?
  bitrate          Int?
  bitsPerSample    Int?
  sampleRate       Int?
  duration         Int?
  lossless         Boolean?
  numberOfChannels Int?
  size             Int?
  // relation entries to Artist via the join table
  genre            MusicGenre[]

  album     Album?          @relation(fields: [albumId], references: [id])
  artist    Artist?         @relation(fields: [artistId], references: [id])
  playlists PlaylistMusic[]
}

model MusicGenre {
  musicId Int
  genreId Int

  music Music @relation(fields: [musicId], references: [id])
  genre Genre @relation(fields: [genreId], references: [id])

  @@id([musicId, genreId])
}

model Playlist {
  id   Int    @id @default(autoincrement())
  name String

  music PlaylistMusic[]
}

model PlaylistMusic {
  playlistId Int
  musicId    Int

  playlist Playlist @relation(fields: [playlistId], references: [id])
  music    Music    @relation(fields: [musicId], references: [id])

  @@id([playlistId, musicId])
}
